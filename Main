import javax.swing.*;
import java.awt.*;
import java.util.HashMap;
import java.util.Map;

public class Main extends JFrame {
    private Font font;
    private JPanel panelArbol;
    private JTextField texto;
    private RBT<Integer> rbt = new RBT<>();
    private Map<Nodo<Integer>, Point> posiciones = new HashMap<>();

    public Main() {
        super("graficar RBT 24130025");
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();
        setSize(screenSize);
        setExtendedState(getExtendedState() | JFrame.MAXIMIZED_BOTH);
        getContentPane().setBackground(Color.BLUE);
        setLocationRelativeTo(null); // Centrar
        font = new Font("Arial", Font.BOLD, 25);
        setFont(font);

        panelArbol = new JPanel() {
            @Override
            protected void paintComponent(Graphics g) {
                super.paintComponent(g);
                dibujarlineas((Graphics2D) g);
            }
        };
        panelArbol.setBackground(Color.WHITE);
            this.add(panelArbol, BorderLayout.CENTER);

        JPanel panel = new JPanel();
            panel.setLayout(new GridLayout(1, 3));
                this.add(panel, BorderLayout.NORTH);
        JButton boton = new JButton("Insertar");
            boton.setBackground(Color.GREEN);
                boton.setFont(font);
        JButton botonBorrar = new JButton("Eliminar");
            botonBorrar.setBackground(Color.RED);
                botonBorrar.setFont(font);
                    boton.addActionListener(e -> this.dibujar());
        botonBorrar.addActionListener(e -> {
            int value = Integer.parseInt(texto.getText());
            rbt.deletevalidar(value);

            posiciones.clear();
            int aa = (int) Math.ceil(Math.log(Math.max(1, rbt.size)) / Math.log(2));
                aa = Math.max(aa, 1) + 2;
                    int ancho = panelArbol.getWidth();
            int alto = panelArbol.getHeight();
                if (ancho <= 0 || alto <= 0) {
                    ancho = 1000;
                    alto = 600;
                }
            int xCentro = ancho / 2;
            calcularPosiciones(rbt.root, 1, posiciones, ancho, alto, xCentro, aa);
                panelArbol.repaint();
        });
        texto = new JTextField(40);
            texto.setFont(font);
                texto.setHorizontalAlignment(JTextField.CENTER);
            panel.add(texto);
        panel.add(boton);

        panel.add(botonBorrar);
        setVisible(true);
    }


    public void calcularPosiciones(Nodo<Integer> nodo, int nivel, Map<Nodo<Integer>, Point> posiciones, int ancho, int alto, int x, int aa) {
        if (nodo == null) return;
            int distancia = Math.max(40, (ancho / (nivel + 1)) / 2);
        int y = alto / aa * nivel;
        posiciones.put(nodo, new Point(x, y));
            calcularPosiciones(nodo.left, nivel + 1, posiciones, ancho, alto, x - distancia, aa);
                calcularPosiciones(nodo.right, nivel + 1, posiciones, ancho, alto, x + distancia, aa);
    }


    public void dibujar() {

        int value = Integer.parseInt(texto.getText());
            rbt.insert(value);

        int aa = (int) Math.ceil(Math.log(Math.max(1, rbt.size)) / Math.log(2));
            aa = Math.max(aa, 1) + 2;

        int ancho = panelArbol.getWidth();
            int alto = panelArbol.getHeight();
                if (ancho <= 0 || alto <= 0) {
                    ancho = 1000;
                    alto = 600;
                }

        posiciones.clear();
            int xCentro = ancho / 2;
                calcularPosiciones(rbt.root, 1, posiciones, ancho, alto, xCentro, aa);

        System.out.println("Tamaño del árbol: " + rbt.size);
                for (Map.Entry<Nodo<Integer>, Point> e : posiciones.entrySet()) {
                    Nodo<Integer> n = e.getKey();
                                Point p = e.getValue();
                            System.out.println("Nodo: " + n.elemento + " Posición: (" + p.x + ", " + p.y + ")");
                }

        panelArbol.repaint();
    }

    private void dibujarlineas(Graphics2D g2) {
        g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);
            int diametro = 40;
                int radio = diametro / 2;

        g2.setColor(Color.BLACK);
            g2.setStroke(new BasicStroke(3));
        for (Map.Entry<Nodo<Integer>, Point> entry : posiciones.entrySet()) {
            Nodo<Integer> nodo = entry.getKey();
            Point p = entry.getValue();
                    if (nodo == null || p == null) continue;

            int px = p.x;
            int py = p.y;

                    if (nodo.left != null && posiciones.containsKey(nodo.left)) {
                        Point pl = posiciones.get(nodo.left);
                                if (pl != null) {
                                    int lx = pl.x;
                                    int ly = pl.y;
                                    g2.drawLine(px, py + radio / 2, lx, ly - radio / 2);
                                }
                    }
            if (nodo.right != null && posiciones.containsKey(nodo.right)) {
                Point pr = posiciones.get(nodo.right);
                    if (pr != null) {
                        int rx = pr.x;
                        int ry = pr.y;
                        g2.drawLine(px, py + radio / 2, rx, ry - radio / 2);
                    }
            }
        }

        for (Map.Entry<Nodo<Integer>, Point> entry : posiciones.entrySet()) {
            Nodo<Integer> nodo = entry.getKey();
            Point p = entry.getValue();

                if (nodo == null || p == null) continue;

                int x = p.x - diametro / 2;
            int y = p.y - diametro / 2;

                g2.setColor(nodo.color != null ? nodo.color : Color.BLACK);
                g2.fillOval(x, y, diametro, diametro);

    g2.setColor(Color.BLACK);
    g2.setStroke(new BasicStroke(2));
    g2.drawOval(x, y, diametro, diametro);

    g2.setFont(font);
    String text = "" + nodo.elemento;
    FontMetrics fm = g2.getFontMetrics();
    int textX = x + (diametro - fm.stringWidth(text)) / 2;
    int textY = y + ((diametro - fm.getHeight()) / 2) + fm.getAscent();
    g2.setColor(Color.WHITE);
    g2.drawString(text, textX, textY);
        }
    }

    public static void main(String[] args) {
        SwingUtilities.invokeLater(() -> {
            new Main();
        });
    System.out.println("Nueva graficacion de arbol rbt (red black tree)");
    System.out.println("Puntos usados");
    }
}
            
